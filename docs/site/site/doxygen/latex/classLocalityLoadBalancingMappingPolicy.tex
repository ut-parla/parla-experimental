\hypertarget{classLocalityLoadBalancingMappingPolicy}{}\doxysection{Locality\+Load\+Balancing\+Mapping\+Policy Class Reference}
\label{classLocalityLoadBalancingMappingPolicy}\index{LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}}


{\ttfamily \#include $<$policy.\+hpp$>$}



Inheritance diagram for Locality\+Load\+Balancing\+Mapping\+Policy\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=248pt]{classLocalityLoadBalancingMappingPolicy__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for Locality\+Load\+Balancing\+Mapping\+Policy\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=340pt]{classLocalityLoadBalancingMappingPolicy__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_ad4dd7032ab349a74f3ab4498c867a341}{calc\+\_\+score\+\_\+devplacement}} (\mbox{\hyperlink{classInnerTask}{Inner\+Task}} $\ast$task, const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDeviceRequirement}{Device\+Requirement}} $>$ \&dev\+\_\+placement\+\_\+req, const \mbox{\hyperlink{classMapper}{Mapper}} \&mapper, \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\+\_\+t}} $\ast$score, const std\+::vector$<$ std\+::pair$<$ \mbox{\hyperlink{classparray_1_1InnerPArray}{parray\+::\+Inner\+PArray}} $\ast$, \mbox{\hyperlink{runtime_8hpp_ab22d35ed086a478dd91e93ac78037f40}{Access\+Mode}} $>$$>$ \&parray\+\_\+list) override
\begin{DoxyCompactList}\small\item\em Calculate a score of the device placement requirement. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_aeffec6001c338c09f6b971d65804965e}{calc\+\_\+score\+\_\+archplacement}} (\mbox{\hyperlink{classInnerTask}{Inner\+Task}} $\ast$task, \mbox{\hyperlink{classArchitectureRequirement}{Architecture\+Requirement}} $\ast$arch\+\_\+placement\+\_\+req, const \mbox{\hyperlink{classMapper}{Mapper}} \&mapper, std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDeviceRequirement}{Device\+Requirement}} $>$ \&chosen\+\_\+dev\+\_\+req, \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\+\_\+t}} $\ast$chosen\+\_\+dev\+\_\+score, const std\+::vector$<$ std\+::pair$<$ \mbox{\hyperlink{classparray_1_1InnerPArray}{parray\+::\+Inner\+PArray}} $\ast$, \mbox{\hyperlink{runtime_8hpp_ab22d35ed086a478dd91e93ac78037f40}{Access\+Mode}} $>$$>$ \&parray\+\_\+list, std\+::vector$<$ bool $>$ $\ast$is\+\_\+dev\+\_\+assigned=nullptr) override
\begin{DoxyCompactList}\small\item\em Calculate a score of the architecture placement requirement. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_a1f33fe9c821604def797319186daedb1}{calc\+\_\+score\+\_\+mdevplacement}} (\mbox{\hyperlink{classInnerTask}{Inner\+Task}} $\ast$task, \mbox{\hyperlink{classMultiDeviceRequirements}{Multi\+Device\+Requirements}} $\ast$mdev\+\_\+placement\+\_\+req, const \mbox{\hyperlink{classMapper}{Mapper}} \&mapper, std\+::vector$<$ std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDeviceRequirement}{Device\+Requirement}} $>$$>$ $\ast$member\+\_\+device\+\_\+reqs, \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\+\_\+t}} $\ast$average\+\_\+score, const std\+::vector$<$ std\+::vector$<$ std\+::pair$<$ \mbox{\hyperlink{classparray_1_1InnerPArray}{parray\+::\+Inner\+PArray}} $\ast$, \mbox{\hyperlink{runtime_8hpp_ab22d35ed086a478dd91e93ac78037f40}{Access\+Mode}} $>$$>$$>$ \&parray\+\_\+list) override
\begin{DoxyCompactList}\small\item\em Calculate a score of the multi-\/device placement that users passed. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_a79f908105a56080847ce82ec89f7ff9e}{run\+\_\+task\+\_\+mapping}} (\mbox{\hyperlink{classInnerTask}{Inner\+Task}} $\ast$task, const \mbox{\hyperlink{classMapper}{Mapper}} \&mapper, std\+::vector$<$ std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDeviceRequirement}{Device\+Requirement}} $>$$>$ $\ast$chosen\+\_\+devices, const std\+::vector$<$ std\+::vector$<$ std\+::pair$<$ \mbox{\hyperlink{classparray_1_1InnerPArray}{parray\+::\+Inner\+PArray}} $\ast$, \mbox{\hyperlink{runtime_8hpp_ab22d35ed086a478dd91e93ac78037f40}{Access\+Mode}} $>$$>$$>$ \&parray\+\_\+list, std\+::vector$<$ std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classPlacementRequirementBase}{Placement\+Requirement\+Base}} $>$$>$ $\ast$placement\+\_\+req\+\_\+options\+\_\+vec)
\item 
\mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_a1c2860ab6caf48e27a869c05d6c29c44}{Mapping\+Policy}} (\mbox{\hyperlink{classDeviceManager}{Device\+Manager}} $\ast$device\+\_\+manager, \mbox{\hyperlink{classPArrayTracker}{PArray\+Tracker}} $\ast$parray\+\_\+tracker)
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}


Definition at line 121 of file policy.\+hpp.



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classLocalityLoadBalancingMappingPolicy_aeffec6001c338c09f6b971d65804965e}\label{classLocalityLoadBalancingMappingPolicy_aeffec6001c338c09f6b971d65804965e}} 
\index{LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}!calc\_score\_archplacement@{calc\_score\_archplacement}}
\index{calc\_score\_archplacement@{calc\_score\_archplacement}!LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}}
\doxysubsubsection{\texorpdfstring{calc\_score\_archplacement()}{calc\_score\_archplacement()}}
{\footnotesize\ttfamily bool Locality\+Load\+Balancing\+Mapping\+Policy\+::calc\+\_\+score\+\_\+archplacement (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classInnerTask}{Inner\+Task}} $\ast$}]{task,  }\item[{\mbox{\hyperlink{classArchitectureRequirement}{Architecture\+Requirement}} $\ast$}]{arch\+\_\+placement\+\_\+req,  }\item[{const \mbox{\hyperlink{classMapper}{Mapper}} \&}]{mapper,  }\item[{std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDeviceRequirement}{Device\+Requirement}} $>$ \&}]{chosen\+\_\+dev\+\_\+req,  }\item[{\mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\+\_\+t}} $\ast$}]{chosen\+\_\+dev\+\_\+score,  }\item[{const std\+::vector$<$ std\+::pair$<$ \mbox{\hyperlink{classparray_1_1InnerPArray}{parray\+::\+Inner\+PArray}} $\ast$, \mbox{\hyperlink{runtime_8hpp_ab22d35ed086a478dd91e93ac78037f40}{Access\+Mode}} $>$$>$ \&}]{parray\+\_\+list,  }\item[{std\+::vector$<$ bool $>$ $\ast$}]{is\+\_\+dev\+\_\+assigned = {\ttfamily nullptr} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Calculate a score of the architecture placement requirement. 

This function first iterates devices of the architecture, and calculates a score for each device based on the current states of the device (e.\+g., available memory and the number of vcus). It returns a device giving the best score and its score. Note that it does not choose a device for a task, but the caller, so the task mapper, will choose one of the placement options.


\begin{DoxyParams}{Parameters}
{\em task} & Target task for task mapping. \\
\hline
{\em arch\+\_\+placement\+\_\+req} & Resource requirement of the architecture. \\
\hline
{\em mapper} & \mbox{\hyperlink{classMapper}{Mapper}} instance to get mapping information. \\
\hline
{\em chosen\+\_\+dev\+\_\+req} & A pointer of a chosen device and its resource requirement. This is a reference type since this function chooses a device and updates its pointer to the device requirement. \\
\hline
{\em chosen\+\_\+dev\+\_\+score} & A pointer of a score of the chosen device. \\
\hline
{\em parray\+\_\+list} & A list of PArray instances used by the target task \\
\hline
{\em is\+\_\+dev\+\_\+assigned} & Multi-\/device task is not allowed to be assigned to duplicated devices. This vector marks assigned devices and avoid that case. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if any device in the architecture is available 
\end{DoxyReturn}


Implements \mbox{\hyperlink{classMappingPolicy_a86509271105b3cf0c7478c63e3e0469d}{Mapping\+Policy}}.



Definition at line 93 of file policy.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{99                                       \{}
\DoxyCodeLine{100   \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\_t}} best\_score\{-\/1\};}
\DoxyCodeLine{101   \textcolor{comment}{// If any device was chosen as a candidate device,}}
\DoxyCodeLine{102   \textcolor{comment}{// it is set to True and the best\_score is used to be compared}}
\DoxyCodeLine{103   \textcolor{comment}{// and find the next better candidate device.}}
\DoxyCodeLine{104   \textcolor{keywordtype}{bool} any\_device\_chosen\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{105   std::shared\_ptr<DeviceRequirement> best\_device\_req\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{106   \textcolor{comment}{// std::cout << task-\/>get\_name() << "{}inside arch req mapping. "{} << std::endl;}}
\DoxyCodeLine{107   \textcolor{comment}{// TODO(wlr): Is this unused??}}
\DoxyCodeLine{108   uint32\_t \mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}}\{0\};}
\DoxyCodeLine{109   \textcolor{keywordtype}{bool} is\_arch\_available\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{110   \textcolor{comment}{// For now the architecture placement has one resource requirement}}
\DoxyCodeLine{111   \textcolor{comment}{// regardless of the devices of the architecture. In the future,}}
\DoxyCodeLine{112   \textcolor{comment}{// we will allow a separate placement for each device.}}
\DoxyCodeLine{113   \textcolor{keyword}{auto} placement\_options = arch\_placement\_req-\/>\mbox{\hyperlink{classArchitectureRequirement_af3412a9dcf9a72a470bbacdaff85b496}{GetDeviceRequirementOptions}}();}
\DoxyCodeLine{114   \textcolor{keywordtype}{int} n\_options = placement\_options.size();}
\DoxyCodeLine{115   \textcolor{keywordtype}{int} start\_idx = ++this-\/>\mbox{\hyperlink{classMappingPolicy_a3ae7076b9ebc8601ea06d3743cf12178}{rrcount}};}
\DoxyCodeLine{116 }
\DoxyCodeLine{117   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 0; k < n\_options; k++) \{}
\DoxyCodeLine{118     \textcolor{keywordtype}{int} idx = (start\_idx + k) \% n\_options;}
\DoxyCodeLine{119     std::shared\_ptr<DeviceRequirement> dev\_req = placement\_options[idx];}
\DoxyCodeLine{120     \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\_t}} score\{0\};}
\DoxyCodeLine{121     \mbox{\hyperlink{device_8hpp_a1a60ef2726088f66773542604d44bdd7}{DevID\_t}} dev\_global\_id = dev\_req-\/>device()-\/>get\_global\_id();}
\DoxyCodeLine{122     \textcolor{keywordflow}{if} (is\_dev\_assigned != \textcolor{keyword}{nullptr} \&\&}
\DoxyCodeLine{123         (*is\_dev\_assigned)[dev\_global\_id] == \textcolor{keyword}{true}) \{}
\DoxyCodeLine{124       \textcolor{comment}{// If this architecture placement is the member of a}}
\DoxyCodeLine{125       \textcolor{comment}{// multi-\/device task and this visiting device is already chosen}}
\DoxyCodeLine{126       \textcolor{comment}{// as one of the placements, skip it.}}
\DoxyCodeLine{127       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{128     \}}
\DoxyCodeLine{129     \textcolor{keywordtype}{bool} is\_dev\_available = this-\/>\mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_ad4dd7032ab349a74f3ab4498c867a341}{calc\_score\_devplacement}}(task, dev\_req, mapper,}
\DoxyCodeLine{130                                                           \&score, parray\_list);}
\DoxyCodeLine{131     \textcolor{keywordflow}{if} (!is\_dev\_available) \{}
\DoxyCodeLine{132       \textcolor{keywordflow}{continue};}
\DoxyCodeLine{133     \}}
\DoxyCodeLine{134     is\_arch\_available = \textcolor{keyword}{true};}
\DoxyCodeLine{135     \textcolor{keywordflow}{if} (!any\_device\_chosen || best\_score <= score) \{}
\DoxyCodeLine{136       best\_score = score;}
\DoxyCodeLine{137       best\_device\_req = dev\_req;}
\DoxyCodeLine{138       any\_device\_chosen = \textcolor{keyword}{true};}
\DoxyCodeLine{139     \}}
\DoxyCodeLine{140     ++\mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}};}
\DoxyCodeLine{141   \}}
\DoxyCodeLine{142   assert(best\_device\_req != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{143   chosen\_dev\_req = best\_device\_req;}
\DoxyCodeLine{144   *chosen\_dev\_score = best\_score;}
\DoxyCodeLine{145   \textcolor{keywordflow}{return} is\_arch\_available;}
\DoxyCodeLine{146 \}}

\end{DoxyCode}


References Mapping\+Policy\+::rrcount.

\mbox{\Hypertarget{classLocalityLoadBalancingMappingPolicy_ad4dd7032ab349a74f3ab4498c867a341}\label{classLocalityLoadBalancingMappingPolicy_ad4dd7032ab349a74f3ab4498c867a341}} 
\index{LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}!calc\_score\_devplacement@{calc\_score\_devplacement}}
\index{calc\_score\_devplacement@{calc\_score\_devplacement}!LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}}
\doxysubsubsection{\texorpdfstring{calc\_score\_devplacement()}{calc\_score\_devplacement()}}
{\footnotesize\ttfamily bool Locality\+Load\+Balancing\+Mapping\+Policy\+::calc\+\_\+score\+\_\+devplacement (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classInnerTask}{Inner\+Task}} $\ast$}]{task,  }\item[{const std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDeviceRequirement}{Device\+Requirement}} $>$ \&}]{dev\+\_\+placement\+\_\+req,  }\item[{const \mbox{\hyperlink{classMapper}{Mapper}} \&}]{mapper,  }\item[{\mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\+\_\+t}} $\ast$}]{score,  }\item[{const std\+::vector$<$ std\+::pair$<$ \mbox{\hyperlink{classparray_1_1InnerPArray}{parray\+::\+Inner\+PArray}} $\ast$, \mbox{\hyperlink{runtime_8hpp_ab22d35ed086a478dd91e93ac78037f40}{Access\+Mode}} $>$$>$ \&}]{parray\+\_\+list }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Calculate a score of the device placement requirement. 

This function calculates a score of a device based on the current states of the device (e.\+g., available memory and the number of vcus). It returns a device giving the best score and its score. Note that it does not choose a device for a task, but the caller, so the task mapper, will choose one of the placement options.


\begin{DoxyParams}{Parameters}
{\em task} & Target task for task mapping. \\
\hline
{\em dev\+\_\+placement\+\_\+req} & Resource requirement of the device. \\
\hline
{\em mapper} & \mbox{\hyperlink{classMapper}{Mapper}} instance to get mapping information. \\
\hline
{\em score} & A pointer of a score of the device. \\
\hline
{\em parray\+\_\+list} & A list of PArray instances used by the target task \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if a device is available 
\end{DoxyReturn}


Implements \mbox{\hyperlink{classMappingPolicy_a1ee22460c08db5ba7a07ab3ec673bc7b}{Mapping\+Policy}}.



Definition at line 4 of file policy.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{9                       \{}
\DoxyCodeLine{10   \textcolor{keyword}{const} \mbox{\hyperlink{classDevice}{Device}} \&device = *(dev\_placement\_req-\/>device());}
\DoxyCodeLine{11   \mbox{\hyperlink{device_8hpp_a1a60ef2726088f66773542604d44bdd7}{DevID\_t}} global\_dev\_id = device.\mbox{\hyperlink{classDevice_a7a4beec758f8c827ffce31562ee9ebdb}{get\_global\_id}}();}
\DoxyCodeLine{12   \textcolor{comment}{// std::cout << "{}[Locality-\/aware-\/ and Load-\/balancing mapping policy]\(\backslash\)n"{};}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14   \textcolor{comment}{// Check device resource availability.}}
\DoxyCodeLine{15   \textcolor{keywordflow}{if} (!device.\mbox{\hyperlink{classDevice_aca1649a233aee0f1251e1a16faf45ab3}{check\_resource\_availability}}(dev\_placement\_req.get())) \{}
\DoxyCodeLine{16     \textcolor{comment}{// std::cout << "{}Device resource failure!"{} << std::endl;}}
\DoxyCodeLine{17     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{18   \}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20   \textcolor{comment}{// PArray locality.}}
\DoxyCodeLine{21   \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\_t}} local\_data\{0\}, nonlocal\_data\{0\};}
\DoxyCodeLine{22   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}} = 0; \mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}} < parray\_list.size(); ++\mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}}) \{}
\DoxyCodeLine{23     \mbox{\hyperlink{classparray_1_1InnerPArray}{InnerPArray}} *\mbox{\hyperlink{namespaceparray}{parray}} = parray\_list[\mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}}].first;}
\DoxyCodeLine{24     \textcolor{keywordflow}{if} (\mbox{\hyperlink{classMappingPolicy_a70abf983ec3855f3a8f15db9930c5c82}{parray\_tracker\_}}-\/>\mbox{\hyperlink{classPArrayTracker_af30dd11bb2cd542a82916aab560e1840}{get\_parray\_state}}(global\_dev\_id, \mbox{\hyperlink{namespaceparray}{parray}}-\/>parent\_id)) \{}
\DoxyCodeLine{25       local\_data += \mbox{\hyperlink{namespaceparray}{parray}}-\/>get\_size();}
\DoxyCodeLine{26     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{27       nonlocal\_data += \mbox{\hyperlink{namespaceparray}{parray}}-\/>get\_size();}
\DoxyCodeLine{28     \}}
\DoxyCodeLine{29   \}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{31   \textcolor{comment}{// XXX(hc) These device\_memory\_size is too big and so we are not normalizing}}
\DoxyCodeLine{32   \textcolor{comment}{//         them to the size.}}
\DoxyCodeLine{33   \mbox{\hyperlink{resources_8hpp_af7b216c3232c4a212aba859a02f42004}{Resource\_t}} device\_memory\_size = device.\mbox{\hyperlink{classDevice_a4b26ae0012a7b853adb6e98de08d88b1}{query\_resource}}(\mbox{\hyperlink{resources_8hpp_acf246a87e41f47012fc7628989d3fe95a4789f23283b3a61f858b641a1bef19a3}{Resource::Memory}});}
\DoxyCodeLine{34   local\_data /= device\_memory\_size;}
\DoxyCodeLine{35   nonlocal\_data /= device\_memory\_size;}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 \textcolor{preprocessor}{\#if 0}}
\DoxyCodeLine{39   \textcolor{comment}{// TODO(hc): This metric is duplicated with data locality.}}
\DoxyCodeLine{40   \textcolor{comment}{// Check how many dependencies are mapped to the device candidate}}
\DoxyCodeLine{41   \textcolor{comment}{// being checked.}}
\DoxyCodeLine{42   \textcolor{comment}{// Note that this only considers dependencies specified in a task}}
\DoxyCodeLine{43   \textcolor{comment}{// @spawn decorator. So to speak, it considers immediate dependencies}}
\DoxyCodeLine{44   \textcolor{comment}{// and does not consider the whole dependency subtree.}}
\DoxyCodeLine{45   \mbox{\hyperlink{classProtectedVector}{TaskList}} \&\mbox{\hyperlink{namespaceparla_1_1cython_1_1core_a73544bbbe214712d0f0b214c64ebae9f}{dependencies}} = \mbox{\hyperlink{namespaceparla_1_1cython_1_1core_a80c42ae6cf7c7174352631aa0d84cbe0}{task}}-\/>dependencies;}
\DoxyCodeLine{46   \textcolor{keywordtype}{size\_t} num\_dependencies\_on\_device\{0\};}
\DoxyCodeLine{47   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}} = 0; \mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}} < \mbox{\hyperlink{namespaceparla_1_1cython_1_1core_a73544bbbe214712d0f0b214c64ebae9f}{dependencies}}.size\_unsafe(); ++\mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}}) \{}
\DoxyCodeLine{48     \mbox{\hyperlink{classInnerTask}{InnerTask}} *\mbox{\hyperlink{namespaceparla_1_1cython_1_1core_a82cc47fc5c9d4bba41ac5f3031d1e8fc}{dependency}} = \mbox{\hyperlink{namespaceparla_1_1cython_1_1core_a73544bbbe214712d0f0b214c64ebae9f}{dependencies}}.at\_unsafe(\mbox{\hyperlink{namespaceparla_1_1cython_1_1tasks_a17820f0441e4e8e4a8af4a5c50bae09d}{i}});}
\DoxyCodeLine{49     \textcolor{keywordflow}{for} (\mbox{\hyperlink{classDevice}{Device}} *dependency\_devices : \mbox{\hyperlink{namespaceparla_1_1cython_1_1core_a82cc47fc5c9d4bba41ac5f3031d1e8fc}{dependency}}-\/>assigned\_devices) \{}
\DoxyCodeLine{50       \textcolor{keywordflow}{if} (dependency\_devices-\/>\mbox{\hyperlink{classDevice_a7a4beec758f8c827ffce31562ee9ebdb}{get\_global\_id}}() == device.\mbox{\hyperlink{classDevice_a7a4beec758f8c827ffce31562ee9ebdb}{get\_global\_id}}()) \{}
\DoxyCodeLine{51         ++num\_dependencies\_on\_device;}
\DoxyCodeLine{52         \textcolor{keywordflow}{break};}
\DoxyCodeLine{53       \}}
\DoxyCodeLine{54     \}}
\DoxyCodeLine{55   \}}
\DoxyCodeLine{56   \textcolor{comment}{// std::cout << num\_dependencies\_on\_device << "{} of the "{} << task-\/>get\_name()}}
\DoxyCodeLine{57   \textcolor{comment}{//           << "{}s dependencies have been mapped to device "{} <<}}
\DoxyCodeLine{58   \textcolor{comment}{//           device.get\_name()}}
\DoxyCodeLine{59   \textcolor{comment}{//           << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{60 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{61 }
\DoxyCodeLine{62   \textcolor{comment}{// Calculate device load balancing.}}
\DoxyCodeLine{63   \textcolor{keywordtype}{size\_t} total\_num\_mapped\_tasks = mapper.\mbox{\hyperlink{classMapper_a3e63ef68173ab3c9ce42e0e077e681cf}{atomic\_load\_total\_num\_mapped\_tasks}}();}
\DoxyCodeLine{64   \textcolor{keywordtype}{size\_t} num\_tasks\_to\_device =}
\DoxyCodeLine{65       mapper.\mbox{\hyperlink{classMapper_a4fda5c4fbe57ee41131f07d039d45d37}{atomic\_load\_dev\_num\_mapped\_tasks\_device}}(device.\mbox{\hyperlink{classDevice_a7a4beec758f8c827ffce31562ee9ebdb}{get\_global\_id}}());}
\DoxyCodeLine{66   \textcolor{keywordtype}{double} normalizd\_device\_load\{0\};}
\DoxyCodeLine{67   \textcolor{keywordflow}{if} (total\_num\_mapped\_tasks != 0) \{}
\DoxyCodeLine{68     normalizd\_device\_load =}
\DoxyCodeLine{69         num\_tasks\_to\_device / double(total\_num\_mapped\_tasks);}
\DoxyCodeLine{70   \}}
\DoxyCodeLine{71 }
\DoxyCodeLine{72   \textcolor{comment}{// Avoid negative score and make this focus on load balancing if data}}
\DoxyCodeLine{73   \textcolor{comment}{// is not used.}}
\DoxyCodeLine{74   *score = 50;}
\DoxyCodeLine{75   *score +=}
\DoxyCodeLine{76       (30.0 * local\_data -\/ 30.0 * nonlocal\_data -\/ 10 * normalizd\_device\_load);}
\DoxyCodeLine{77 }
\DoxyCodeLine{78   \textcolor{comment}{/*}}
\DoxyCodeLine{79 \textcolor{comment}{  std::cout << "{}Device "{} << device.get\_name() << "{}'s score: "{} << *score <<}}
\DoxyCodeLine{80 \textcolor{comment}{    "{} for task "{}<< task-\/>get\_name() << "{} local data: "{} << local\_data <<}}
\DoxyCodeLine{81 \textcolor{comment}{    "{} non local data:"{} << nonlocal\_data << "{} normalized device load:"{} <<}}
\DoxyCodeLine{82 \textcolor{comment}{    normalizd\_device\_load << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{83 \textcolor{comment}{  */}}
\DoxyCodeLine{84   \textcolor{comment}{/*}}
\DoxyCodeLine{85 \textcolor{comment}{  std::cout << "{}\(\backslash\)t[Device Requirement in device Requirement]\(\backslash\)n"{}}}
\DoxyCodeLine{86 \textcolor{comment}{            << "{}\(\backslash\)t\(\backslash\)t"{} << dev\_placement\_req-\/>device()-\/>get\_name() << "{} -\/> "{}}}
\DoxyCodeLine{87 \textcolor{comment}{            << dev\_placement\_req-\/>res\_req().get(Resource::Memory) << "{}B, VCU"{}}}
\DoxyCodeLine{88 \textcolor{comment}{            << dev\_placement\_req-\/>res\_req().get(Resource::VCU) << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{89 \textcolor{comment}{  */}}
\DoxyCodeLine{90   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{91 \}}

\end{DoxyCode}


References Mapper\+::atomic\+\_\+load\+\_\+total\+\_\+num\+\_\+mapped\+\_\+tasks().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classLocalityLoadBalancingMappingPolicy_ad4dd7032ab349a74f3ab4498c867a341_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classLocalityLoadBalancingMappingPolicy_a1f33fe9c821604def797319186daedb1}\label{classLocalityLoadBalancingMappingPolicy_a1f33fe9c821604def797319186daedb1}} 
\index{LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}!calc\_score\_mdevplacement@{calc\_score\_mdevplacement}}
\index{calc\_score\_mdevplacement@{calc\_score\_mdevplacement}!LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}}
\doxysubsubsection{\texorpdfstring{calc\_score\_mdevplacement()}{calc\_score\_mdevplacement()}}
{\footnotesize\ttfamily bool Locality\+Load\+Balancing\+Mapping\+Policy\+::calc\+\_\+score\+\_\+mdevplacement (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classInnerTask}{Inner\+Task}} $\ast$}]{task,  }\item[{\mbox{\hyperlink{classMultiDeviceRequirements}{Multi\+Device\+Requirements}} $\ast$}]{mdev\+\_\+placement\+\_\+req,  }\item[{const \mbox{\hyperlink{classMapper}{Mapper}} \&}]{mapper,  }\item[{std\+::vector$<$ std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDeviceRequirement}{Device\+Requirement}} $>$$>$ $\ast$}]{member\+\_\+device\+\_\+reqs,  }\item[{\mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\+\_\+t}} $\ast$}]{average\+\_\+score,  }\item[{const std\+::vector$<$ std\+::vector$<$ std\+::pair$<$ \mbox{\hyperlink{classparray_1_1InnerPArray}{parray\+::\+Inner\+PArray}} $\ast$, \mbox{\hyperlink{runtime_8hpp_ab22d35ed086a478dd91e93ac78037f40}{Access\+Mode}} $>$$>$$>$ \&}]{parray\+\_\+list }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



Calculate a score of the multi-\/device placement that users passed. 

The placement requirement could contain multiple device or/and architecture requirements. This function calculates a score for each placement requirement by recursively calling a device or an architecture score calculation function and averages those scores. This average is used as a score of the multi-\/device placement and the caller, so the task mapper, will choose one of the placement options that give the best score.


\begin{DoxyParams}{Parameters}
{\em task} & Target task for task mapping. \\
\hline
{\em mdev\+\_\+placement\+\_\+req} & Resource requirement of the multiple devices. \\
\hline
{\em mapper} & \mbox{\hyperlink{classMapper}{Mapper}} instance to get mapping information. \\
\hline
{\em member\+\_\+device\+\_\+reqs} & A vector of the resource requirement of the member device. \\
\hline
{\em chosen\+\_\+dev\+\_\+score} & A pointer of a score of the multiple devices. \\
\hline
{\em parray\+\_\+list} & A list of PArray instances used by the target task \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if all devices in the multi-\/device placement are available. 
\end{DoxyReturn}


Implements \mbox{\hyperlink{classMappingPolicy_a5cd045c4167ac1c7e542fec83eaae55d}{Mapping\+Policy}}.



Definition at line 148 of file policy.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{154                       \{}
\DoxyCodeLine{155   *average\_score = 0;}
\DoxyCodeLine{156   \textcolor{keyword}{const} std::vector<std::shared\_ptr<SinglePlacementRequirementBase>>}
\DoxyCodeLine{157       \&placement\_reqs\_vec = mdev\_placement\_req-\/>\mbox{\hyperlink{classMultiDeviceRequirements_ac5e4ee0e9a54f8e45318f9059aea9540}{get\_placement\_reqs\_ref}}();}
\DoxyCodeLine{158   member\_device\_reqs-\/>resize(placement\_reqs\_vec.size());}
\DoxyCodeLine{159   \textcolor{comment}{// Task mapper does not allow to map a multi-\/device task to the same device}}
\DoxyCodeLine{160   \textcolor{comment}{// multiple times. This vector marks an assigned device and filter it}}
\DoxyCodeLine{161   \textcolor{comment}{// out at the next device decision.}}
\DoxyCodeLine{162   std::vector<bool> is\_dev\_assigned(}
\DoxyCodeLine{163       this-\/>\mbox{\hyperlink{classMappingPolicy_a3943af0460a1a7053151449167da0d26}{device\_manager\_}}-\/>\mbox{\hyperlink{classDeviceManager_ad3dba27b05b965eba693d8fecd89f9c7}{get\_num\_devices}}<\mbox{\hyperlink{device_8hpp_ad258d4c51629346fceac4679b3209ad9ab1c94ca2fbc3e78fc30069c8d0f01680}{DeviceType::All}}>(), \textcolor{keyword}{false});}
\DoxyCodeLine{164   \textcolor{comment}{// Iterate requirements of the devices specified in multi-\/device placement.}}
\DoxyCodeLine{165   \textcolor{comment}{// All of the member devices should be available.}}
\DoxyCodeLine{166   \textcolor{keywordflow}{for} (\mbox{\hyperlink{device_8hpp_a1a60ef2726088f66773542604d44bdd7}{DevID\_t}} did = 0; did < placement\_reqs\_vec.size(); ++did) \{}
\DoxyCodeLine{167     std::shared\_ptr<SinglePlacementRequirementBase> placement\_req =}
\DoxyCodeLine{168         placement\_reqs\_vec[did];}
\DoxyCodeLine{169     std::shared\_ptr<DeviceRequirement> dev\_req\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{170     \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\_t}} score\{0\};}
\DoxyCodeLine{171     \textcolor{keywordtype}{bool} is\_member\_device\_available\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{172     \textcolor{keywordflow}{if} (placement\_req-\/>is\_dev\_req()) \{}
\DoxyCodeLine{173       dev\_req = std::dynamic\_pointer\_cast<DeviceRequirement>(placement\_req);}
\DoxyCodeLine{174       \mbox{\hyperlink{device_8hpp_a1a60ef2726088f66773542604d44bdd7}{DevID\_t}} dev\_global\_id = dev\_req-\/>device()-\/>get\_global\_id();}
\DoxyCodeLine{175       \textcolor{keywordflow}{if} (!is\_dev\_assigned[dev\_global\_id]) \{}
\DoxyCodeLine{176         is\_member\_device\_available = this-\/>\mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_ad4dd7032ab349a74f3ab4498c867a341}{calc\_score\_devplacement}}(}
\DoxyCodeLine{177             task, dev\_req, mapper, \&score, parray\_list[did]);}
\DoxyCodeLine{178         \textcolor{keywordflow}{if} (is\_member\_device\_available) \{}
\DoxyCodeLine{179           is\_dev\_assigned[dev\_global\_id] = \textcolor{keyword}{true};}
\DoxyCodeLine{180         \}}
\DoxyCodeLine{181       \}}
\DoxyCodeLine{182     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (placement\_req-\/>is\_arch\_req()) \{}
\DoxyCodeLine{183       \mbox{\hyperlink{classArchitectureRequirement}{ArchitectureRequirement}} *arch\_req =}
\DoxyCodeLine{184           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classArchitectureRequirement}{ArchitectureRequirement}} *\textcolor{keyword}{>}(placement\_req.get());}
\DoxyCodeLine{185       is\_member\_device\_available = this-\/>\mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_aeffec6001c338c09f6b971d65804965e}{calc\_score\_archplacement}}(}
\DoxyCodeLine{186           task, arch\_req, mapper, dev\_req, \&score, parray\_list[did],}
\DoxyCodeLine{187           \&is\_dev\_assigned);}
\DoxyCodeLine{188       \textcolor{keywordflow}{if} (is\_member\_device\_available) \{}
\DoxyCodeLine{189         \mbox{\hyperlink{device_8hpp_a1a60ef2726088f66773542604d44bdd7}{DevID\_t}} dev\_global\_id = dev\_req-\/>device()-\/>get\_global\_id();}
\DoxyCodeLine{190         is\_dev\_assigned[dev\_global\_id] = \textcolor{keyword}{true};}
\DoxyCodeLine{191       \}}
\DoxyCodeLine{192     \}}
\DoxyCodeLine{193     assert(dev\_req != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{194     (*member\_device\_reqs)[did] = dev\_req;}
\DoxyCodeLine{195     *average\_score += score;}
\DoxyCodeLine{196     \textcolor{keywordflow}{if} (!is\_member\_device\_available) \{}
\DoxyCodeLine{197       \textcolor{comment}{// If any of the device candidates is not available,}}
\DoxyCodeLine{198       \textcolor{comment}{// return false and exclude this option from task mapping.}}
\DoxyCodeLine{199       \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{200     \}}
\DoxyCodeLine{201   \}}
\DoxyCodeLine{202   *average\_score /= placement\_reqs\_vec.size();}
\DoxyCodeLine{203   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{204 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classLocalityLoadBalancingMappingPolicy_a1c2860ab6caf48e27a869c05d6c29c44}\label{classLocalityLoadBalancingMappingPolicy_a1c2860ab6caf48e27a869c05d6c29c44}} 
\index{LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}!MappingPolicy@{MappingPolicy}}
\index{MappingPolicy@{MappingPolicy}!LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}}
\doxysubsubsection{\texorpdfstring{MappingPolicy()}{MappingPolicy()}}
{\footnotesize\ttfamily Mapping\+Policy\+::\+Mapping\+Policy\hspace{0.3cm}{\ttfamily [inline]}}



Definition at line 24 of file policy.\+hpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{25       : \mbox{\hyperlink{classMappingPolicy_a3943af0460a1a7053151449167da0d26}{device\_manager\_}}(device\_manager), \mbox{\hyperlink{classMappingPolicy_a70abf983ec3855f3a8f15db9930c5c82}{parray\_tracker\_}}(parray\_tracker) \{\}}

\end{DoxyCode}
\mbox{\Hypertarget{classLocalityLoadBalancingMappingPolicy_a79f908105a56080847ce82ec89f7ff9e}\label{classLocalityLoadBalancingMappingPolicy_a79f908105a56080847ce82ec89f7ff9e}} 
\index{LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}!run\_task\_mapping@{run\_task\_mapping}}
\index{run\_task\_mapping@{run\_task\_mapping}!LocalityLoadBalancingMappingPolicy@{LocalityLoadBalancingMappingPolicy}}
\doxysubsubsection{\texorpdfstring{run\_task\_mapping()}{run\_task\_mapping()}}
{\footnotesize\ttfamily void Locality\+Load\+Balancing\+Mapping\+Policy\+::run\+\_\+task\+\_\+mapping (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classInnerTask}{Inner\+Task}} $\ast$}]{task,  }\item[{const \mbox{\hyperlink{classMapper}{Mapper}} \&}]{mapper,  }\item[{std\+::vector$<$ std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDeviceRequirement}{Device\+Requirement}} $>$$>$ $\ast$}]{chosen\+\_\+devices,  }\item[{const std\+::vector$<$ std\+::vector$<$ std\+::pair$<$ \mbox{\hyperlink{classparray_1_1InnerPArray}{parray\+::\+Inner\+PArray}} $\ast$, \mbox{\hyperlink{runtime_8hpp_ab22d35ed086a478dd91e93ac78037f40}{Access\+Mode}} $>$$>$$>$ \&}]{parray\+\_\+list,  }\item[{std\+::vector$<$ std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classPlacementRequirementBase}{Placement\+Requirement\+Base}} $>$$>$ $\ast$}]{placement\+\_\+req\+\_\+options\+\_\+vec }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [virtual]}}



Implements \mbox{\hyperlink{classMappingPolicy_af7104ce13c7b25e8913829e0ad5e4a12}{Mapping\+Policy}}.



Definition at line 206 of file policy.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{211                                                                                    \{}
\DoxyCodeLine{212   \textcolor{comment}{// A set of chosen devices to a task.}}
\DoxyCodeLine{213   \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\_t}} best\_score\{-\/1\};}
\DoxyCodeLine{214   \textcolor{comment}{// If any device was chosen as a candidate device,}}
\DoxyCodeLine{215   \textcolor{comment}{// it is set to True and the best\_score is used to be compared}}
\DoxyCodeLine{216   \textcolor{comment}{// and find the next better candidate device.}}
\DoxyCodeLine{217   \textcolor{keywordtype}{bool} any\_device\_chosen\{\textcolor{keyword}{false}\};}
\DoxyCodeLine{218 }
\DoxyCodeLine{219   \textcolor{comment}{// Iterate all placement requirements passed by users and calculate}}
\DoxyCodeLine{220   \textcolor{comment}{// scores based on a policy.}}
\DoxyCodeLine{221   \textcolor{keywordflow}{for} (std::shared\_ptr<PlacementRequirementBase> base\_req :}
\DoxyCodeLine{222        *placement\_req\_options\_vec) \{}
\DoxyCodeLine{223     \textcolor{keywordflow}{if} (base\_req-\/>is\_multidev\_req()) \{}
\DoxyCodeLine{224       \textcolor{comment}{// Multi-\/device placement requirements.}}
\DoxyCodeLine{225       \textcolor{comment}{// std::cout << "{}[Multi-\/device requirement]\(\backslash\)n"{};}}
\DoxyCodeLine{226       \mbox{\hyperlink{classMultiDeviceRequirements}{MultiDeviceRequirements}} *mdev\_reqs =}
\DoxyCodeLine{227           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classMultiDeviceRequirements}{MultiDeviceRequirements}} *\textcolor{keyword}{>}(base\_req.get());}
\DoxyCodeLine{228       std::vector<std::shared\_ptr<DeviceRequirement>> mdev\_reqs\_vec;}
\DoxyCodeLine{229       \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\_t}} score\{0\};}
\DoxyCodeLine{230       \textcolor{keywordtype}{bool} is\_req\_available = \mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_a1f33fe9c821604def797319186daedb1}{calc\_score\_mdevplacement}}(}
\DoxyCodeLine{231           \mbox{\hyperlink{namespaceparla_1_1cython_1_1core_a80c42ae6cf7c7174352631aa0d84cbe0}{task}}, mdev\_reqs, mapper, \&mdev\_reqs\_vec, \&score, parray\_list);}
\DoxyCodeLine{232       \textcolor{keywordflow}{if} (!is\_req\_available) \{}
\DoxyCodeLine{233         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{234       \}}
\DoxyCodeLine{235       \textcolor{keywordflow}{if} (best\_score <= score || !any\_device\_chosen) \{}
\DoxyCodeLine{236         best\_score = score;}
\DoxyCodeLine{237         chosen\_devices-\/>swap(mdev\_reqs\_vec);}
\DoxyCodeLine{238         any\_device\_chosen = \textcolor{keyword}{true};}
\DoxyCodeLine{239       \}}
\DoxyCodeLine{240     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (base\_req-\/>is\_dev\_req()) \{}
\DoxyCodeLine{241       \textcolor{comment}{// A single device placement requirement.}}
\DoxyCodeLine{242       std::shared\_ptr<DeviceRequirement> dev\_req =}
\DoxyCodeLine{243           std::dynamic\_pointer\_cast<DeviceRequirement>(base\_req);}
\DoxyCodeLine{244       \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\_t}} score\{0\};}
\DoxyCodeLine{245       \textcolor{keywordtype}{bool} is\_req\_available = \mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_ad4dd7032ab349a74f3ab4498c867a341}{calc\_score\_devplacement}}(}
\DoxyCodeLine{246           \mbox{\hyperlink{namespaceparla_1_1cython_1_1core_a80c42ae6cf7c7174352631aa0d84cbe0}{task}}, dev\_req, mapper, \&score, parray\_list[0]);}
\DoxyCodeLine{247       \textcolor{keywordflow}{if} (!is\_req\_available) \{}
\DoxyCodeLine{248         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{249       \}}
\DoxyCodeLine{250       \textcolor{keywordflow}{if} (best\_score <= score || !any\_device\_chosen) \{}
\DoxyCodeLine{251         assert(dev\_req != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{252         best\_score = score;}
\DoxyCodeLine{253         chosen\_devices-\/>clear();}
\DoxyCodeLine{254         chosen\_devices-\/>emplace\_back(dev\_req);}
\DoxyCodeLine{255         any\_device\_chosen = \textcolor{keyword}{true};}
\DoxyCodeLine{256       \}}
\DoxyCodeLine{257     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (base\_req-\/>is\_arch\_req()) \{}
\DoxyCodeLine{258       \textcolor{comment}{// A single architecture placement requirement.}}
\DoxyCodeLine{259       \mbox{\hyperlink{classArchitectureRequirement}{ArchitectureRequirement}} *arch\_req =}
\DoxyCodeLine{260           \textcolor{keyword}{dynamic\_cast<}\mbox{\hyperlink{classArchitectureRequirement}{ArchitectureRequirement}} *\textcolor{keyword}{>}(base\_req.get());}
\DoxyCodeLine{261       std::shared\_ptr<DeviceRequirement> chosen\_dev\_req\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{262       \mbox{\hyperlink{policy_8hpp_acc133555210d07ca50d128e110e9e7a9}{Score\_t}} chosen\_dev\_score\{0\};}
\DoxyCodeLine{263       \textcolor{comment}{// std::cout << "{}[Mapper] Task name:"{} << task-\/>get\_name() << "{}, "{} <<}}
\DoxyCodeLine{264       \textcolor{comment}{// "{}Checking arch requirement."{}}}
\DoxyCodeLine{265       \textcolor{comment}{//           << "{}\(\backslash\)n"{};}}
\DoxyCodeLine{266       \textcolor{keywordtype}{bool} is\_req\_available = \mbox{\hyperlink{classLocalityLoadBalancingMappingPolicy_aeffec6001c338c09f6b971d65804965e}{calc\_score\_archplacement}}(}
\DoxyCodeLine{267           \mbox{\hyperlink{namespaceparla_1_1cython_1_1core_a80c42ae6cf7c7174352631aa0d84cbe0}{task}}, arch\_req, mapper, chosen\_dev\_req, \&chosen\_dev\_score,}
\DoxyCodeLine{268           parray\_list[0]);}
\DoxyCodeLine{269       \textcolor{keywordflow}{if} (!is\_req\_available) \{}
\DoxyCodeLine{270         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{271       \}}
\DoxyCodeLine{272       \textcolor{keywordflow}{if} (best\_score <= chosen\_dev\_score || !any\_device\_chosen) \{}
\DoxyCodeLine{273         assert(chosen\_dev\_req != \textcolor{keyword}{nullptr});}
\DoxyCodeLine{274         best\_score = chosen\_dev\_score;}
\DoxyCodeLine{275         chosen\_devices-\/>clear();}
\DoxyCodeLine{276         chosen\_devices-\/>emplace\_back(chosen\_dev\_req);}
\DoxyCodeLine{277         any\_device\_chosen = \textcolor{keyword}{true};}
\DoxyCodeLine{278       \}}
\DoxyCodeLine{279     \}}
\DoxyCodeLine{280   \}}
\DoxyCodeLine{281 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
src/c/backend/include/\mbox{\hyperlink{policy_8hpp}{policy.\+hpp}}\item 
src/c/backend/\mbox{\hyperlink{policy_8cpp}{policy.\+cpp}}\end{DoxyCompactItemize}
