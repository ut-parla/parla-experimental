<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Parla: MemoryReserver Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Parla
   </div>
   <div id="projectbrief">Heterogeneous Parallel Programming in Python</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pro-static-attribs">Static Protected Attributes</a> &#124;
<a href="classMemoryReserver-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">MemoryReserver Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classMemoryReserver.html" title="MemoryReserver phase of the scheduler.">MemoryReserver</a> phase of the scheduler.  
 <a href="classMemoryReserver.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="phases_8hpp_source.html">phases.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for MemoryReserver:</div>
<div class="dyncontent">
<div class="center"><img src="classMemoryReserver__inherit__graph.png" border="0" usemap="#aMemoryReserver_inherit__map" alt="Inheritance graph"/></div>
<map name="aMemoryReserver_inherit__map" id="aMemoryReserver_inherit__map">
<area shape="rect" title="MemoryReserver phase of the scheduler." alt="" coords="5,80,140,107"/>
<area shape="rect" href="classSchedulerPhase.html" title="Abstract Interface for general scheduler runtime phase." alt="" coords="10,5,135,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for MemoryReserver:</div>
<div class="dyncontent">
<div class="center"><img src="classMemoryReserver__coll__graph.png" border="0" usemap="#aMemoryReserver_coll__map" alt="Collaboration graph"/></div>
<map name="aMemoryReserver_coll__map" id="aMemoryReserver_coll__map">
<area shape="rect" title="MemoryReserver phase of the scheduler." alt="" coords="660,233,795,260"/>
<area shape="rect" href="classInnerScheduler.html" title="The C++ &quot;Mirror&quot; of Parla&#39;s Python Scheduler This class is used to create a C++ representation of a P..." alt="" coords="1053,353,1172,380"/>
<area shape="rect" href="classSchedulerPhase.html" title="Abstract Interface for general scheduler runtime phase." alt="" coords="1403,349,1529,376"/>
<area shape="rect" href="classLauncher.html" title=" " alt="" coords="1775,107,1856,133"/>
<area shape="rect" href="classRuntimeReserver.html" title="RuntimeReserver phase of the scheduler." alt="" coords="1748,288,1883,315"/>
<area shape="rect" href="classMapper.html" title="Mapper phase of the scheduler." alt="" coords="1780,425,1851,452"/>
<area shape="rect" href="classDeviceManager.html" title="DeviceManager registers/provides devices and their information on the current system to the Parla run..." alt="" coords="309,509,433,536"/>
<area shape="rect" href="classPArrayTracker.html" title=" " alt="" coords="672,457,783,484"/>
<area shape="rect" href="classProtectedVector.html" title=" " alt="" coords="1344,107,1588,133"/>
<area shape="rect" href="classLauncherStatus.html" title=" " alt="" coords="1405,5,1527,32"/>
<area shape="rect" href="classPhaseStatus.html" title=" " alt="" coords="1000,5,1225,32"/>
<area shape="rect" href="classProtectedVector.html" title=" " alt="" coords="1352,56,1580,83"/>
<area shape="rect" href="classRuntimeReserverStatus.html" title=" " alt="" coords="1378,157,1554,184"/>
<area shape="rect" href="classPhaseStatus.html" title=" " alt="" coords="997,150,1228,191"/>
<area shape="rect" href="classScheduler_1_1Status.html" title=" " alt="" coords="660,289,795,316"/>
<area shape="rect" title=" " alt="" coords="685,340,770,367"/>
<area shape="rect" href="classWorkerPool.html" title=" " alt="" coords="627,391,828,433"/>
<area shape="rect" href="classProtectedQueue.html" title=" " alt="" coords="1351,400,1581,427"/>
<area shape="rect" href="classMapperStatus.html" title=" " alt="" coords="1410,569,1522,596"/>
<area shape="rect" href="classPhaseStatus.html" title=" " alt="" coords="1005,621,1220,648"/>
<area shape="rect" href="classMemoryReserverStatus.html" title=" " alt="" coords="284,233,459,260"/>
<area shape="rect" href="classPhaseStatus.html" title=" " alt="" coords="5,226,235,267"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8e030d125362eb12aa0fe7a81242d71e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#a8e030d125362eb12aa0fe7a81242d71e">MemoryReserver</a> (<a class="el" href="classInnerScheduler.html">InnerScheduler</a> *<a class="el" href="classSchedulerPhase.html#a5b1a4e7a44cc2162e50cded7bba4376f">scheduler</a>, <a class="el" href="classDeviceManager.html">DeviceManager</a> *devices)</td></tr>
<tr class="separator:a8e030d125362eb12aa0fe7a81242d71e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2127dac8a80858f60a723345a7b7e8bc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#a2127dac8a80858f60a723345a7b7e8bc">enqueue</a> (<a class="el" href="classInnerTask.html">InnerTask</a> *task)</td></tr>
<tr class="memdesc:a2127dac8a80858f60a723345a7b7e8bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enqueue a task to the phase.  <a href="classMemoryReserver.html#a2127dac8a80858f60a723345a7b7e8bc">More...</a><br /></td></tr>
<tr class="separator:a2127dac8a80858f60a723345a7b7e8bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99c935a4dd4940daa0be370e2f8d9de9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#a99c935a4dd4940daa0be370e2f8d9de9">enqueue</a> (std::vector&lt; <a class="el" href="classInnerTask.html">InnerTask</a> * &gt; &amp;tasks)</td></tr>
<tr class="memdesc:a99c935a4dd4940daa0be370e2f8d9de9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enqueue a vector of tasks to the phase.  <a href="classMemoryReserver.html#a99c935a4dd4940daa0be370e2f8d9de9">More...</a><br /></td></tr>
<tr class="separator:a99c935a4dd4940daa0be370e2f8d9de9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03b6be802b5d6d19761773fa7a1df866"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#a03b6be802b5d6d19761773fa7a1df866">run</a> (<a class="el" href="classSchedulerPhase.html">SchedulerPhase</a> *next_phase)</td></tr>
<tr class="memdesc:a03b6be802b5d6d19761773fa7a1df866"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run the phase. Check tasks in the enqueued buffer, check phase condition, and move tasks to the next phase.  <a href="classMemoryReserver.html#a03b6be802b5d6d19761773fa7a1df866">More...</a><br /></td></tr>
<tr class="separator:a03b6be802b5d6d19761773fa7a1df866"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe7011e52a6115c22c09aa4ce80b37e4"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#afe7011e52a6115c22c09aa4ce80b37e4">get_count</a> ()</td></tr>
<tr class="memdesc:afe7011e52a6115c22c09aa4ce80b37e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the number of tasks enqueued (and waiting) in the phase.  <a href="classMemoryReserver.html#afe7011e52a6115c22c09aa4ce80b37e4">More...</a><br /></td></tr>
<tr class="separator:afe7011e52a6115c22c09aa4ce80b37e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classSchedulerPhase"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classSchedulerPhase')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classSchedulerPhase.html">SchedulerPhase</a></td></tr>
<tr class="memitem:af30330d46896e1e64815407abbb06ab8 inherit pub_methods_classSchedulerPhase"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSchedulerPhase.html#af30330d46896e1e64815407abbb06ab8">SchedulerPhase</a> ()=default</td></tr>
<tr class="separator:af30330d46896e1e64815407abbb06ab8 inherit pub_methods_classSchedulerPhase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac072216548814d50ca21391a6bb3c240 inherit pub_methods_classSchedulerPhase"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSchedulerPhase.html#ac072216548814d50ca21391a6bb3c240">SchedulerPhase</a> (<a class="el" href="classInnerScheduler.html">InnerScheduler</a> *<a class="el" href="classSchedulerPhase.html#a5b1a4e7a44cc2162e50cded7bba4376f">scheduler</a>, <a class="el" href="classDeviceManager.html">DeviceManager</a> *devices)</td></tr>
<tr class="memdesc:ac072216548814d50ca21391a6bb3c240 inherit pub_methods_classSchedulerPhase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor for the scheduler phase.  <a href="classSchedulerPhase.html#ac072216548814d50ca21391a6bb3c240">More...</a><br /></td></tr>
<tr class="separator:ac072216548814d50ca21391a6bb3c240 inherit pub_methods_classSchedulerPhase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:ac87a697034b92fb1ee9d45816cb0195c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#ac87a697034b92fb1ee9d45816cb0195c">check_resources</a> (<a class="el" href="classInnerTask.html">InnerTask</a> *task)</td></tr>
<tr class="separator:ac87a697034b92fb1ee9d45816cb0195c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a687d9b805c9c57ca25c944abe186b789"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#a687d9b805c9c57ca25c944abe186b789">reserve_resources</a> (<a class="el" href="classInnerTask.html">InnerTask</a> *task)</td></tr>
<tr class="separator:a687d9b805c9c57ca25c944abe186b789"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afefeed97cbedbebe983d4c9b770bf50f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#afefeed97cbedbebe983d4c9b770bf50f">create_datamove_tasks</a> (<a class="el" href="classInnerTask.html">InnerTask</a> *task)</td></tr>
<tr class="separator:afefeed97cbedbebe983d4c9b770bf50f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a50abec0ef02597ad2b1d74d18c5ec954"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="classPhaseManager.html">PhaseManager</a>&lt; <a class="el" href="resources_8hpp.html#aaf78cb490f07150f95154e6a8c907436a5fe7b9358c9cb1b9eaa8d5aec000def4">ResourceCategory::Persistent</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#a50abec0ef02597ad2b1d74d18c5ec954">reservable_tasks</a></td></tr>
<tr class="separator:a50abec0ef02597ad2b1d74d18c5ec954"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a664c53b781e239f130c5a6426052ae38"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classMemoryReserverStatus.html">MemoryReserverStatus</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#a664c53b781e239f130c5a6426052ae38">status</a> {<a class="el" href="classMemoryReserver.html#a966fdf0157ff4674c887804c3938dc39">name</a>}</td></tr>
<tr class="separator:a664c53b781e239f130c5a6426052ae38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac879854e744f973327d1c4c76bc2a0ef"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classInnerTask.html">InnerTask</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#ac879854e744f973327d1c4c76bc2a0ef">reserved_tasks_buffer</a></td></tr>
<tr class="separator:ac879854e744f973327d1c4c76bc2a0ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_attribs_classSchedulerPhase"><td colspan="2" onclick="javascript:toggleInherit('pro_attribs_classSchedulerPhase')"><img src="closed.png" alt="-"/>&#160;Protected Attributes inherited from <a class="el" href="classSchedulerPhase.html">SchedulerPhase</a></td></tr>
<tr class="memitem:a0ebc5d496229586112174dba4ab370a6 inherit pro_attribs_classSchedulerPhase"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSchedulerPhase.html#a0ebc5d496229586112174dba4ab370a6">mtx</a></td></tr>
<tr class="memdesc:a0ebc5d496229586112174dba4ab370a6 inherit pro_attribs_classSchedulerPhase"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex lock for the phase (In case of a workerthread driven scheduler, ensure only 1 thread is running the phase at a time)  <a href="classSchedulerPhase.html#a0ebc5d496229586112174dba4ab370a6">More...</a><br /></td></tr>
<tr class="separator:a0ebc5d496229586112174dba4ab370a6 inherit pro_attribs_classSchedulerPhase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b1a4e7a44cc2162e50cded7bba4376f inherit pro_attribs_classSchedulerPhase"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classInnerScheduler.html">InnerScheduler</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSchedulerPhase.html#a5b1a4e7a44cc2162e50cded7bba4376f">scheduler</a></td></tr>
<tr class="memdesc:a5b1a4e7a44cc2162e50cded7bba4376f inherit pro_attribs_classSchedulerPhase"><td class="mdescLeft">&#160;</td><td class="mdescRight">The scheduler that the phase belongs to.  <a href="classSchedulerPhase.html#a5b1a4e7a44cc2162e50cded7bba4376f">More...</a><br /></td></tr>
<tr class="separator:a5b1a4e7a44cc2162e50cded7bba4376f inherit pro_attribs_classSchedulerPhase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafed560a47871439d6ff5a2b404159f3 inherit pro_attribs_classSchedulerPhase"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDeviceManager.html">DeviceManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSchedulerPhase.html#aafed560a47871439d6ff5a2b404159f3">device_manager</a></td></tr>
<tr class="memdesc:aafed560a47871439d6ff5a2b404159f3 inherit pro_attribs_classSchedulerPhase"><td class="mdescLeft">&#160;</td><td class="mdescRight">The device manager that the phase uses.  <a href="classSchedulerPhase.html#aafed560a47871439d6ff5a2b404159f3">More...</a><br /></td></tr>
<tr class="separator:aafed560a47871439d6ff5a2b404159f3 inherit pro_attribs_classSchedulerPhase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab309120518ecaa5abdaba9c4ece2bf5a inherit pro_attribs_classSchedulerPhase"><td class="memItemLeft" align="right" valign="top"><a class="el" href="runtime_8hpp.html#a171f42e65e96e59208fe7f526af5586a">TaskStateList</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSchedulerPhase.html#ab309120518ecaa5abdaba9c4ece2bf5a">enqueue_buffer</a></td></tr>
<tr class="memdesc:ab309120518ecaa5abdaba9c4ece2bf5a inherit pro_attribs_classSchedulerPhase"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of tasks enqueued (and waiting) in the phase.  <a href="classSchedulerPhase.html#ab309120518ecaa5abdaba9c4ece2bf5a">More...</a><br /></td></tr>
<tr class="separator:ab309120518ecaa5abdaba9c4ece2bf5a inherit pro_attribs_classSchedulerPhase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-static-attribs"></a>
Static Protected Attributes</h2></td></tr>
<tr class="memitem:a966fdf0157ff4674c887804c3938dc39"><td class="memItemLeft" align="right" valign="top">static const std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMemoryReserver.html#a966fdf0157ff4674c887804c3938dc39">name</a> {&quot;Memory Reserver&quot;}</td></tr>
<tr class="separator:a966fdf0157ff4674c887804c3938dc39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_static_attribs_classSchedulerPhase"><td colspan="2" onclick="javascript:toggleInherit('pro_static_attribs_classSchedulerPhase')"><img src="closed.png" alt="-"/>&#160;Static Protected Attributes inherited from <a class="el" href="classSchedulerPhase.html">SchedulerPhase</a></td></tr>
<tr class="memitem:a60d3156832ed1307565a9b936a62e1e6 inherit pro_static_attribs_classSchedulerPhase"><td class="memItemLeft" align="right" valign="top">static const std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSchedulerPhase.html#a60d3156832ed1307565a9b936a62e1e6">name</a> {&quot;Phase&quot;}</td></tr>
<tr class="memdesc:a60d3156832ed1307565a9b936a62e1e6 inherit pro_static_attribs_classSchedulerPhase"><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the phase. Used for debugging and tracing.  <a href="classSchedulerPhase.html#a60d3156832ed1307565a9b936a62e1e6">More...</a><br /></td></tr>
<tr class="separator:a60d3156832ed1307565a9b936a62e1e6 inherit pro_static_attribs_classSchedulerPhase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classMemoryReserver.html" title="MemoryReserver phase of the scheduler.">MemoryReserver</a> phase of the scheduler. </p>
<p>Reserves all 'persistent resources`.</p>
<p>This phase plans task execution on the device set. Here all 'persistent resources` that have a lifetime greater than the task body are reserved and shared between tasks. Typically this means the memory that the task uses for both its input, output, and intermediate workspace. Memory usage is planned and reserved ahead of task execution to allow input data to be prefetched onto the devices through data movement tasks. </p>

<p class="definition">Definition at line <a class="el" href="phases_8hpp_source.html#l00227">227</a> of file <a class="el" href="phases_8hpp_source.html">phases.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a8e030d125362eb12aa0fe7a81242d71e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e030d125362eb12aa0fe7a81242d71e">&#9670;&nbsp;</a></span>MemoryReserver()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MemoryReserver::MemoryReserver </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classInnerScheduler.html">InnerScheduler</a> *&#160;</td>
          <td class="paramname"><em>scheduler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classDeviceManager.html">DeviceManager</a> *&#160;</td>
          <td class="paramname"><em>devices</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="phases_8hpp_source.html#l00229">229</a> of file <a class="el" href="phases_8hpp_source.html">phases.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      : <a class="code" href="classSchedulerPhase.html#af30330d46896e1e64815407abbb06ab8">SchedulerPhase</a>(<a class="code" href="classSchedulerPhase.html#a5b1a4e7a44cc2162e50cded7bba4376f">scheduler</a>, <a class="code" href="namespaceparla_1_1cython_1_1core.html#a4cd77e2b819d63fe1c64f5f59c52360b">devices</a>) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    this-&gt;<a class="code" href="classMemoryReserver.html#a50abec0ef02597ad2b1d74d18c5ec954">reservable_tasks</a> =</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        std::make_shared&lt;PhaseManager&lt;ResourceCategory::Persistent&gt;&gt;(<a class="code" href="namespaceparla_1_1cython_1_1core.html#a4cd77e2b819d63fe1c64f5f59c52360b">devices</a>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  }</div>
<div class="ttc" id="aclassMemoryReserver_html_a50abec0ef02597ad2b1d74d18c5ec954"><div class="ttname"><a href="classMemoryReserver.html#a50abec0ef02597ad2b1d74d18c5ec954">MemoryReserver::reservable_tasks</a></div><div class="ttdeci">std::shared_ptr&lt; PhaseManager&lt; ResourceCategory::Persistent &gt; &gt; reservable_tasks</div><div class="ttdef"><b>Definition:</b> <a href="phases_8hpp_source.html#l00241">phases.hpp:241</a></div></div>
<div class="ttc" id="aclassSchedulerPhase_html_a5b1a4e7a44cc2162e50cded7bba4376f"><div class="ttname"><a href="classSchedulerPhase.html#a5b1a4e7a44cc2162e50cded7bba4376f">SchedulerPhase::scheduler</a></div><div class="ttdeci">InnerScheduler * scheduler</div><div class="ttdoc">The scheduler that the phase belongs to.</div><div class="ttdef"><b>Definition:</b> <a href="phases_8hpp_source.html#l00130">phases.hpp:130</a></div></div>
<div class="ttc" id="aclassSchedulerPhase_html_af30330d46896e1e64815407abbb06ab8"><div class="ttname"><a href="classSchedulerPhase.html#af30330d46896e1e64815407abbb06ab8">SchedulerPhase::SchedulerPhase</a></div><div class="ttdeci">SchedulerPhase()=default</div></div>
<div class="ttc" id="anamespaceparla_1_1cython_1_1core_html_a4cd77e2b819d63fe1c64f5f59c52360b"><div class="ttname"><a href="namespaceparla_1_1cython_1_1core.html#a4cd77e2b819d63fe1c64f5f59c52360b">parla.cython.core.devices</a></div><div class="ttdeci">list devices</div><div class="ttdef"><b>Definition:</b> <a href="core_8pyx_source.html#l00292">core.pyx:292</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="classSchedulerPhase.html#ac072216548814d50ca21391a6bb3c240">SchedulerPhase::SchedulerPhase()</a>.</p>

<p class="reference">Referenced by <a class="el" href="classInnerScheduler.html#aaed710c208e5a28162c3b181f8a33d23">InnerScheduler::InnerScheduler()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMemoryReserver_a8e030d125362eb12aa0fe7a81242d71e_cgraph.png" border="0" usemap="#aclassMemoryReserver_a8e030d125362eb12aa0fe7a81242d71e_cgraph" alt=""/></div>
<map name="aclassMemoryReserver_a8e030d125362eb12aa0fe7a81242d71e_cgraph" id="aclassMemoryReserver_a8e030d125362eb12aa0fe7a81242d71e_cgraph">
<area shape="rect" title=" " alt="" coords="5,13,260,39"/>
<area shape="rect" href="classSchedulerPhase.html#ac072216548814d50ca21391a6bb3c240" title="Constructor for the scheduler phase." alt="" coords="308,5,505,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMemoryReserver_a8e030d125362eb12aa0fe7a81242d71e_icgraph.png" border="0" usemap="#aclassMemoryReserver_a8e030d125362eb12aa0fe7a81242d71e_icgraph" alt=""/></div>
<map name="aclassMemoryReserver_a8e030d125362eb12aa0fe7a81242d71e_icgraph" id="aclassMemoryReserver_a8e030d125362eb12aa0fe7a81242d71e_icgraph">
<area shape="rect" title=" " alt="" coords="277,29,532,56"/>
<area shape="rect" href="classInnerScheduler.html#aaed710c208e5a28162c3b181f8a33d23" title=" " alt="" coords="5,29,229,56"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ac87a697034b92fb1ee9d45816cb0195c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac87a697034b92fb1ee9d45816cb0195c">&#9670;&nbsp;</a></span>check_resources()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool MemoryReserver::check_resources </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classInnerTask.html">InnerTask</a> *&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="phases_8cpp_source.html#l00202">202</a> of file <a class="el" href="phases_8cpp_source.html">phases.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                                    {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classMemoryReserver.html#a664c53b781e239f130c5a6426052ae38">status</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classDevice.html">Device</a> *device : <a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>-&gt;assigned_devices) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="classResourcePool.html">ResourcePool_t</a> &amp;task_pool =</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>-&gt;device_constraints[device-&gt;<a class="code" href="classDevice.html#a7a4beec758f8c827ffce31562ee9ebdb">get_global_id</a>()];</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="classResourcePool.html">ResourcePool_t</a> &amp;device_pool = device-&gt;<a class="code" href="classDevice.html#a23e7c65c6d833d56755aead8128763b7">get_reserved_pool</a>();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="classMemoryReserver.html#a664c53b781e239f130c5a6426052ae38">status</a> = device_pool.<a class="code" href="classResourcePool.html#a6e6f954ecbf68bc7039b1a6826664f76">check_greater</a>&lt;<a class="code" href="resources_8hpp.html#aaf78cb490f07150f95154e6a8c907436a5fe7b9358c9cb1b9eaa8d5aec000def4">ResourceCategory::Persistent</a>&gt;(task_pool);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classMemoryReserver.html#a664c53b781e239f130c5a6426052ae38">status</a>) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classMemoryReserver.html#a664c53b781e239f130c5a6426052ae38">status</a>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div>
<div class="ttc" id="aclassDevice_html"><div class="ttname"><a href="classDevice.html">Device</a></div><div class="ttdoc">Devices can be distinguished from other devices by a class type and its index.</div><div class="ttdef"><b>Definition:</b> <a href="device_8hpp_source.html#l00037">device.hpp:37</a></div></div>
<div class="ttc" id="aclassDevice_html_a23e7c65c6d833d56755aead8128763b7"><div class="ttname"><a href="classDevice.html#a23e7c65c6d833d56755aead8128763b7">Device::get_reserved_pool</a></div><div class="ttdeci">ResourcePool_t &amp; get_reserved_pool()</div><div class="ttdoc">Returns the currently reserved resources on the device.</div><div class="ttdef"><b>Definition:</b> <a href="device_8hpp_source.html#l00104">device.hpp:104</a></div></div>
<div class="ttc" id="aclassDevice_html_a7a4beec758f8c827ffce31562ee9ebdb"><div class="ttname"><a href="classDevice.html#a7a4beec758f8c827ffce31562ee9ebdb">Device::get_global_id</a></div><div class="ttdeci">const DevID_t get_global_id() const</div><div class="ttdef"><b>Definition:</b> <a href="device_8hpp_source.html#l00111">device.hpp:111</a></div></div>
<div class="ttc" id="aclassMemoryReserver_html_a664c53b781e239f130c5a6426052ae38"><div class="ttname"><a href="classMemoryReserver.html#a664c53b781e239f130c5a6426052ae38">MemoryReserver::status</a></div><div class="ttdeci">MemoryReserverStatus status</div><div class="ttdef"><b>Definition:</b> <a href="phases_8hpp_source.html#l00243">phases.hpp:243</a></div></div>
<div class="ttc" id="aclassResourcePool_html"><div class="ttname"><a href="classResourcePool.html">ResourcePool</a></div><div class="ttdoc">A pool of resources, allows for comparisons and updates of current values.</div><div class="ttdef"><b>Definition:</b> <a href="resources_8hpp_source.html#l00078">resources.hpp:78</a></div></div>
<div class="ttc" id="aclassResourcePool_html_a6e6f954ecbf68bc7039b1a6826664f76"><div class="ttname"><a href="classResourcePool.html#a6e6f954ecbf68bc7039b1a6826664f76">ResourcePool::check_greater</a></div><div class="ttdeci">const bool check_greater(const ResourcePool &amp;other) const</div><div class="ttdef"><b>Definition:</b> <a href="resources_8hpp_source.html#l00127">resources.hpp:127</a></div></div>
<div class="ttc" id="anamespaceparla_1_1cython_1_1core_html_a80c42ae6cf7c7174352631aa0d84cbe0"><div class="ttname"><a href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">parla.cython.core.task</a></div><div class="ttdeci">task</div><div class="ttdef"><b>Definition:</b> <a href="core_8pyx_source.html#l00138">core.pyx:138</a></div></div>
<div class="ttc" id="aresources_8hpp_html_aaf78cb490f07150f95154e6a8c907436a5fe7b9358c9cb1b9eaa8d5aec000def4"><div class="ttname"><a href="resources_8hpp.html#aaf78cb490f07150f95154e6a8c907436a5fe7b9358c9cb1b9eaa8d5aec000def4">ResourceCategory::Persistent</a></div><div class="ttdeci">@ Persistent</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afefeed97cbedbebe983d4c9b770bf50f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afefeed97cbedbebe983d4c9b770bf50f">&#9670;&nbsp;</a></span>create_datamove_tasks()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void MemoryReserver::create_datamove_tasks </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classInnerTask.html">InnerTask</a> *&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="phases_8cpp_source.html#l00229">229</a> of file <a class="el" href="phases_8cpp_source.html">phases.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                                          {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">// Get a list of the parrays the current task holds.</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keyword">const</span> std::vector&lt;std::vector&lt;std::pair&lt;parray::InnerPArray *, AccessMode&gt;&gt;&gt;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      &amp;parray_list = <a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>-&gt;parray_list;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  std::string task_base_name = <a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>-&gt;get_name();</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  std::vector&lt;InnerTask *&gt; data_tasks;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  data_tasks.reserve(parray_list.size());</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">i</a> = 0; <a class="code" href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">i</a> &lt; parray_list.size(); ++<a class="code" href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">i</a>) {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; parray_list[<a class="code" href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">i</a>].size(); ++j) {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <span class="comment">// Create a data movement task for each PArray.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <a class="code" href="classparray_1_1InnerPArray.html">parray::InnerPArray</a> *<a class="code" href="namespaceparray.html">parray</a> = parray_list[<a class="code" href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">i</a>][j].first;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <a class="code" href="runtime_8hpp.html#ab22d35ed086a478dd91e93ac78037f40">AccessMode</a> access_mode = parray_list[<a class="code" href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">i</a>][j].second;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <a class="code" href="classInnerDataTask.html">InnerDataTask</a> *datamove_task = <span class="keyword">new</span> <a class="code" href="classInnerDataTask.html">InnerDataTask</a>(</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;          <span class="comment">// TODO(hc): id should be updated!</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;          task_base_name + <span class="stringliteral">&quot;.dm.&quot;</span> + std::to_string(<a class="code" href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">i</a>), 0, <a class="code" href="namespaceparray.html">parray</a>, access_mode,</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          <a class="code" href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">i</a>);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keyword">auto</span> &amp;parray_task_list = <a class="code" href="namespaceparray.html">parray</a>-&gt;get_parent_parray()-&gt;get_task_list_ref();</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <span class="comment">// Find dependency intersection between compute and data movement tasks.</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="comment">// TODO(hc): This is not the complete implementation.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="comment">//           We will use a concurrent map for parray&#39;s</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">//           task list as an optimization.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      std::vector&lt;void *&gt; compute_task_dependencies = <a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>-&gt;get_dependencies();</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      std::vector&lt;InnerTask *&gt; data_task_dependencies;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k &lt; compute_task_dependencies.size(); ++k) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="classInnerTask.html">InnerTask</a> *parray_dependency =</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <span class="keyword">static_cast&lt;</span><a class="code" href="classInnerTask.html">InnerTask</a> *<span class="keyword">&gt;</span>(compute_task_dependencies[k]);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">// The task list in PArray is currently thread safe since</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment">// we do not remove tasks from the list but just keep even completed</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment">// task as its implementation is easier.</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> t = 0; t &lt; parray_task_list.size_unsafe(); ++t) {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;          <span class="keywordflow">if</span> (parray_task_list.at_unsafe(t)-&gt;id == parray_dependency-&gt;<a class="code" href="classInnerTask.html#a88465fe59b98a130865d0594ca6c5e6c">id</a>) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            data_task_dependencies.push_back(parray_dependency);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;          }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="comment">// TODO(hc): pass false to add_dependencies() as optimization.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      datamove_task-&gt;<a class="code" href="classInnerTask.html#a1bef1f662fd0defd174abb674b961227">add_dependencies</a>(data_task_dependencies, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="comment">// Copy assigned devices to a compute task to a data movement task.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="comment">// TODO(hc): When we support xpy, it should be devices corresponding</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="comment">//           to placements of the local partition.</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keyword">auto</span> device = <a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>-&gt;get_assigned_devices()[<a class="code" href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">i</a>];</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      datamove_task-&gt;<a class="code" href="classInnerTask.html#ac706288b8bd57400afe204d51793adc7">add_assigned_device</a>(device);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      datamove_task-&gt;<a class="code" href="classInnerTask.html#af5a4e559f41e09788e672a88ac6f0d14">device_constraints</a>.emplace(</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;          std::piecewise_construct,</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;          std::forward_as_tuple(device-&gt;get_global_id()),</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;          std::forward_as_tuple(0, 0, 1));</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      data_tasks.push_back(datamove_task);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="comment">// Add the created data movement task to a reserved task queue.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      this-&gt;<a class="code" href="classSchedulerPhase.html#a5b1a4e7a44cc2162e50cded7bba4376f">scheduler</a>-&gt;<a class="code" href="classInnerScheduler.html#a7dc689561b6acadbb9393ae92a3f3d0f">increase_num_active_tasks</a>();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      this-&gt;<a class="code" href="classMemoryReserver.html#ac879854e744f973327d1c4c76bc2a0ef">reserved_tasks_buffer</a>.push_back(datamove_task);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  }</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// Create dependencies between data move task and compute tasks.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>-&gt;add_dependencies(data_tasks, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div>
<div class="ttc" id="aclassInnerDataTask_html"><div class="ttname"><a href="classInnerDataTask.html">InnerDataTask</a></div><div class="ttdef"><b>Definition:</b> <a href="runtime_8hpp_source.html#l00595">runtime.hpp:595</a></div></div>
<div class="ttc" id="aclassInnerScheduler_html_a7dc689561b6acadbb9393ae92a3f3d0f"><div class="ttname"><a href="classInnerScheduler.html#a7dc689561b6acadbb9393ae92a3f3d0f">InnerScheduler::increase_num_active_tasks</a></div><div class="ttdeci">void increase_num_active_tasks()</div><div class="ttdef"><b>Definition:</b> <a href="scheduler_8cpp_source.html#l00328">scheduler.cpp:328</a></div></div>
<div class="ttc" id="aclassInnerTask_html"><div class="ttname"><a href="classInnerTask.html">InnerTask</a></div><div class="ttdoc">The C++ &quot;Mirror&quot; of Parla's Python Tasks This class is used to create a C++ representation of a Parla...</div><div class="ttdef"><b>Definition:</b> <a href="runtime_8hpp_source.html#l00192">runtime.hpp:192</a></div></div>
<div class="ttc" id="aclassInnerTask_html_a1bef1f662fd0defd174abb674b961227"><div class="ttname"><a href="classInnerTask.html#a1bef1f662fd0defd174abb674b961227">InnerTask::add_dependencies</a></div><div class="ttdeci">Task::StatusFlags add_dependencies(std::vector&lt; InnerTask * &gt; &amp;tasks, bool data_tasks=false)</div><div class="ttdef"><b>Definition:</b> <a href="task_8cpp_source.html#l00121">task.cpp:121</a></div></div>
<div class="ttc" id="aclassInnerTask_html_a88465fe59b98a130865d0594ca6c5e6c"><div class="ttname"><a href="classInnerTask.html#a88465fe59b98a130865d0594ca6c5e6c">InnerTask::id</a></div><div class="ttdeci">long long int id</div><div class="ttdef"><b>Definition:</b> <a href="runtime_8hpp_source.html#l00197">runtime.hpp:197</a></div></div>
<div class="ttc" id="aclassInnerTask_html_ac706288b8bd57400afe204d51793adc7"><div class="ttname"><a href="classInnerTask.html#ac706288b8bd57400afe204d51793adc7">InnerTask::add_assigned_device</a></div><div class="ttdeci">void add_assigned_device(Device *device)</div><div class="ttdef"><b>Definition:</b> <a href="task_8cpp_source.html#l00380">task.cpp:380</a></div></div>
<div class="ttc" id="aclassInnerTask_html_af5a4e559f41e09788e672a88ac6f0d14"><div class="ttname"><a href="classInnerTask.html#af5a4e559f41e09788e672a88ac6f0d14">InnerTask::device_constraints</a></div><div class="ttdeci">std::unordered_map&lt; int, ResourcePool_t &gt; device_constraints</div><div class="ttdef"><b>Definition:</b> <a href="runtime_8hpp_source.html#l00271">runtime.hpp:271</a></div></div>
<div class="ttc" id="aclassMemoryReserver_html_ac879854e744f973327d1c4c76bc2a0ef"><div class="ttname"><a href="classMemoryReserver.html#ac879854e744f973327d1c4c76bc2a0ef">MemoryReserver::reserved_tasks_buffer</a></div><div class="ttdeci">std::vector&lt; InnerTask * &gt; reserved_tasks_buffer</div><div class="ttdef"><b>Definition:</b> <a href="phases_8hpp_source.html#l00244">phases.hpp:244</a></div></div>
<div class="ttc" id="aclassparray_1_1InnerPArray_html"><div class="ttname"><a href="classparray_1_1InnerPArray.html">parray::InnerPArray</a></div><div class="ttdef"><b>Definition:</b> <a href="parray_8hpp_source.html#l00025">parray.hpp:25</a></div></div>
<div class="ttc" id="anamespaceparla_1_1cython_1_1tasks_html_a17820f0441e4e8e4a8af4a5c50bae09d"><div class="ttname"><a href="namespaceparla_1_1cython_1_1tasks.html#a17820f0441e4e8e4a8af4a5c50bae09d">parla.cython.tasks.i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="tasks_8pyx_source.html#l01386">tasks.pyx:1386</a></div></div>
<div class="ttc" id="anamespaceparray_html"><div class="ttname"><a href="namespaceparray.html">parray</a></div><div class="ttdef"><b>Definition:</b> <a href="parray_8cpp_source.html#l00005">parray.cpp:5</a></div></div>
<div class="ttc" id="aruntime_8hpp_html_ab22d35ed086a478dd91e93ac78037f40"><div class="ttname"><a href="runtime_8hpp.html#ab22d35ed086a478dd91e93ac78037f40">AccessMode</a></div><div class="ttdeci">AccessMode</div><div class="ttdef"><b>Definition:</b> <a href="runtime_8hpp_source.html#l00072">runtime.hpp:72</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2127dac8a80858f60a723345a7b7e8bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2127dac8a80858f60a723345a7b7e8bc">&#9670;&nbsp;</a></span>enqueue() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void MemoryReserver::enqueue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classInnerTask.html">InnerTask</a> *&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Enqueue a task to the phase. </p>

<p>Implements <a class="el" href="classSchedulerPhase.html#ab728fba49a9d47d0baa1694df9debb92">SchedulerPhase</a>.</p>

<p class="definition">Definition at line <a class="el" href="phases_8cpp_source.html#l00187">187</a> of file <a class="el" href="phases_8cpp_source.html">phases.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                            {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  this-&gt;<a class="code" href="classMemoryReserver.html#a50abec0ef02597ad2b1d74d18c5ec954">reservable_tasks</a>-&gt;enqueue(task);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="classInnerScheduler.html#a795fa6c6e4123aaff81216d93fc2b874">InnerScheduler::enqueue_task()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMemoryReserver_a2127dac8a80858f60a723345a7b7e8bc_icgraph.png" border="0" usemap="#aclassMemoryReserver_a2127dac8a80858f60a723345a7b7e8bc_icgraph" alt=""/></div>
<map name="aclassMemoryReserver_a2127dac8a80858f60a723345a7b7e8bc_icgraph" id="aclassMemoryReserver_a2127dac8a80858f60a723345a7b7e8bc_icgraph">
<area shape="rect" title="Enqueue a task to the phase." alt="" coords="727,35,925,61"/>
<area shape="rect" href="classInnerScheduler.html#a795fa6c6e4123aaff81216d93fc2b874" title=" " alt="" coords="460,35,679,61"/>
<area shape="rect" href="classInnerScheduler.html#a52bc4a779f9471411c6b0e2f8d720d61" title=" " alt="" coords="208,5,412,32"/>
<area shape="rect" href="classInnerScheduler.html#ae168936fb94b2602cb78867209b12cad" title=" " alt="" coords="233,57,387,98"/>
<area shape="rect" href="classInnerScheduler.html#a379b814bdf9d16a3954036f2f63d3c1a" title=" " alt="" coords="5,57,160,98"/>
</map>
</div>

</div>
</div>
<a id="a99c935a4dd4940daa0be370e2f8d9de9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99c935a4dd4940daa0be370e2f8d9de9">&#9670;&nbsp;</a></span>enqueue() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void MemoryReserver::enqueue </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classInnerTask.html">InnerTask</a> * &gt; &amp;&#160;</td>
          <td class="paramname"><em>tasks</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Enqueue a vector of tasks to the phase. </p>

<p>Implements <a class="el" href="classSchedulerPhase.html#a61e9e3138f4eb16579cde472887e9255">SchedulerPhase</a>.</p>

<p class="definition">Definition at line <a class="el" href="phases_8cpp_source.html#l00191">191</a> of file <a class="el" href="phases_8cpp_source.html">phases.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                                          {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classInnerTask.html">InnerTask</a> *<a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a> : <a class="code" href="namespaceparla_1_1cython_1_1tasks.html#ad0d88a7d8f89ecf110a042149d853fb4">tasks</a>) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    this-&gt;<a class="code" href="classMemoryReserver.html#a2127dac8a80858f60a723345a7b7e8bc">enqueue</a>(<a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  }</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;}</div>
<div class="ttc" id="aclassMemoryReserver_html_a2127dac8a80858f60a723345a7b7e8bc"><div class="ttname"><a href="classMemoryReserver.html#a2127dac8a80858f60a723345a7b7e8bc">MemoryReserver::enqueue</a></div><div class="ttdeci">void enqueue(InnerTask *task)</div><div class="ttdoc">Enqueue a task to the phase.</div><div class="ttdef"><b>Definition:</b> <a href="phases_8cpp_source.html#l00187">phases.cpp:187</a></div></div>
<div class="ttc" id="anamespaceparla_1_1cython_1_1tasks_html_ad0d88a7d8f89ecf110a042149d853fb4"><div class="ttname"><a href="namespaceparla_1_1cython_1_1tasks.html#ad0d88a7d8f89ecf110a042149d853fb4">parla.cython.tasks.tasks</a></div><div class="ttdeci">tasks</div><div class="ttdef"><b>Definition:</b> <a href="tasks_8pyx_source.html#l01335">tasks.pyx:1335</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afe7011e52a6115c22c09aa4ce80b37e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe7011e52a6115c22c09aa4ce80b37e4">&#9670;&nbsp;</a></span>get_count()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t MemoryReserver::get_count </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the number of tasks enqueued (and waiting) in the phase. </p>

<p>Implements <a class="el" href="classSchedulerPhase.html#a0d81d78469a09647970acdc42244e79e">SchedulerPhase</a>.</p>

<p class="definition">Definition at line <a class="el" href="phases_8cpp_source.html#l00197">197</a> of file <a class="el" href="phases_8cpp_source.html">phases.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                 {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordtype">size_t</span> count = this-&gt;<a class="code" href="classMemoryReserver.html#a50abec0ef02597ad2b1d74d18c5ec954">reservable_tasks</a>-&gt;size();</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordflow">return</span> count;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a687d9b805c9c57ca25c944abe186b789"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a687d9b805c9c57ca25c944abe186b789">&#9670;&nbsp;</a></span>reserve_resources()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void MemoryReserver::reserve_resources </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classInnerTask.html">InnerTask</a> *&#160;</td>
          <td class="paramname"><em>task</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="phases_8cpp_source.html#l00218">218</a> of file <a class="el" href="phases_8cpp_source.html">phases.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                                      {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="comment">// TODO(wlr): Add runtime error check if resource failure</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classDevice.html">Device</a> *device : <a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>-&gt;assigned_devices) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="classResourcePool.html">ResourcePool_t</a> &amp;task_pool =</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a>-&gt;device_constraints[device-&gt;<a class="code" href="classDevice.html#a7a4beec758f8c827ffce31562ee9ebdb">get_global_id</a>()];</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="classResourcePool.html">ResourcePool_t</a> &amp;device_pool = device-&gt;<a class="code" href="classDevice.html#a23e7c65c6d833d56755aead8128763b7">get_reserved_pool</a>();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    device_pool.<a class="code" href="classResourcePool.html#aa415c111e9279608cb3a9ca676052a3c">decrease</a>&lt;<a class="code" href="resources_8hpp.html#aaf78cb490f07150f95154e6a8c907436a5fe7b9358c9cb1b9eaa8d5aec000def4">ResourceCategory::Persistent</a>&gt;(task_pool);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;}</div>
<div class="ttc" id="aclassResourcePool_html_aa415c111e9279608cb3a9ca676052a3c"><div class="ttname"><a href="classResourcePool.html#aa415c111e9279608cb3a9ca676052a3c">ResourcePool::decrease</a></div><div class="ttdeci">void decrease(const ResourcePool &amp;other)</div><div class="ttdef"><b>Definition:</b> <a href="resources_8hpp_source.html#l00223">resources.hpp:223</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a03b6be802b5d6d19761773fa7a1df866"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03b6be802b5d6d19761773fa7a1df866">&#9670;&nbsp;</a></span>run()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void MemoryReserver::run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classSchedulerPhase.html">SchedulerPhase</a> *&#160;</td>
          <td class="paramname"><em>next_phase</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Run the phase. Check tasks in the enqueued buffer, check phase condition, and move tasks to the next phase. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">next_phase</td><td>The next phase to move tasks to. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classSchedulerPhase.html#a23e561996d5bbc884e2701d6966f5670">SchedulerPhase</a>.</p>

<p class="definition">Definition at line <a class="el" href="phases_8cpp_source.html#l00292">292</a> of file <a class="el" href="phases_8cpp_source.html">phases.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                                   {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="profiling_8hpp.html#a4ed1a04fa9103ac0c29157e53ed53e66">NVTX_RANGE</a>(<span class="stringliteral">&quot;MemoryReserver::run&quot;</span>, <a class="code" href="profiling_8hpp.html#a166725049865b4af08e946c886ebe327">NVTX_COLOR_LIGHT_GREEN</a>)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">//std::cout &lt;&lt; &quot;MemoryReserver::run&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <a class="code" href="classRuntimeReserver.html">RuntimeReserver</a> *runtime_reserver =</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classRuntimeReserver.html">RuntimeReserver</a> *<span class="keyword">&gt;</span>(next_phase);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="comment">// Only one thread can reserve memory at a time.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="comment">// Useful for a multi-threaded scheduler. Not needed for a single-threaded.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">// std::unique_lock&lt;std::mutex&gt; lock(this-&gt;mtx);</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">// TODO:: Dummy implementation that just passes tasks through</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="keywordtype">bool</span> has_task = this-&gt;<a class="code" href="classMemoryReserver.html#afe7011e52a6115c22c09aa4ce80b37e4">get_count</a>() &gt; 0;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordflow">while</span> (has_task) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <a class="code" href="classInnerTask.html">InnerTask</a> *<a class="code" href="namespaceparla_1_1cython_1_1core.html#a80c42ae6cf7c7174352631aa0d84cbe0">task</a> = this-&gt;<a class="code" href="classMemoryReserver.html#a50abec0ef02597ad2b1d74d18c5ec954">reservable_tasks</a>-&gt;front();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> (task == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;MemoryReserver::run: task is nullptr&quot;</span>);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// Is there enough memory on the devices to schedule this task?</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">bool</span> can_reserve = this-&gt;<a class="code" href="classMemoryReserver.html#ac87a697034b92fb1ee9d45816cb0195c">check_resources</a>(task);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (can_reserve) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      this-&gt;<a class="code" href="classMemoryReserver.html#a687d9b805c9c57ca25c944abe186b789">reserve_resources</a>(task);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      this-&gt;<a class="code" href="classMemoryReserver.html#a50abec0ef02597ad2b1d74d18c5ec954">reservable_tasks</a>-&gt;pop();</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      this-&gt;<a class="code" href="classMemoryReserver.html#afefeed97cbedbebe983d4c9b770bf50f">create_datamove_tasks</a>(task);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      this-&gt;<a class="code" href="classMemoryReserver.html#ac879854e744f973327d1c4c76bc2a0ef">reserved_tasks_buffer</a>.push_back(task);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="comment">// TODO:(wlr) we need some break condition to allow the scheduler to</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="comment">// continue if not enough resources are available Hochan, do you</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="comment">// have any ideas? One failure per scheduler loop (written here) is</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="comment">// bad. Is one failure per device per scheduler loop better?</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    has_task = this-&gt;<a class="code" href="classMemoryReserver.html#afe7011e52a6115c22c09aa4ce80b37e4">get_count</a>() &gt; 0;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="classInnerTask.html">InnerTask</a> *reserved_task : this-&gt;<a class="code" href="classMemoryReserver.html#ac879854e744f973327d1c4c76bc2a0ef">reserved_tasks_buffer</a>) {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    reserved_task-&gt;notify_dependents(this-&gt;<a class="code" href="classSchedulerPhase.html#ab309120518ecaa5abdaba9c4ece2bf5a">enqueue_buffer</a>, <a class="code" href="namespaceTask.html#afa88d99eb2a58c8f078a53f1195c53a8ac0474346713027b27d364defd7bba79b">Task::RESERVED</a>);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    this-&gt;<a class="code" href="classSchedulerPhase.html#a5b1a4e7a44cc2162e50cded7bba4376f">scheduler</a>-&gt;<a class="code" href="classInnerScheduler.html#a6a93e103808105662ffde5d371a8f309">enqueue_tasks</a>(this-&gt;<a class="code" href="classSchedulerPhase.html#ab309120518ecaa5abdaba9c4ece2bf5a">enqueue_buffer</a>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    this-&gt;<a class="code" href="classSchedulerPhase.html#ab309120518ecaa5abdaba9c4ece2bf5a">enqueue_buffer</a>.clear();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">// TODO:(wlr) Create and possibly enqueue data movement tasks</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// Possibly enqueue this task</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordtype">bool</span> enqueue_flag =</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        (reserved_task-&gt;num_blocking_dependencies.fetch_sub(1) == 1);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span> (enqueue_flag) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      reserved_task-&gt;set_status(<a class="code" href="namespaceTask.html#a4397689d62196d2cfecf970fcbed6cb5a04bbf98db0e5595240e01fa33ead9ffc">Task::RUNNABLE</a>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      runtime_reserver-&gt;<a class="code" href="classRuntimeReserver.html#aeab29f38dfdcc8f13fd839bf2629d1f5">enqueue</a>(reserved_task);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  this-&gt;reserved_tasks_buffer.clear();</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;}</div>
<div class="ttc" id="aclassInnerScheduler_html_a6a93e103808105662ffde5d371a8f309"><div class="ttname"><a href="classInnerScheduler.html#a6a93e103808105662ffde5d371a8f309">InnerScheduler::enqueue_tasks</a></div><div class="ttdeci">void enqueue_tasks(TaskStateList &amp;tasks)</div><div class="ttdef"><b>Definition:</b> <a href="scheduler_8cpp_source.html#l00228">scheduler.cpp:228</a></div></div>
<div class="ttc" id="aclassMemoryReserver_html_a687d9b805c9c57ca25c944abe186b789"><div class="ttname"><a href="classMemoryReserver.html#a687d9b805c9c57ca25c944abe186b789">MemoryReserver::reserve_resources</a></div><div class="ttdeci">void reserve_resources(InnerTask *task)</div><div class="ttdef"><b>Definition:</b> <a href="phases_8cpp_source.html#l00218">phases.cpp:218</a></div></div>
<div class="ttc" id="aclassMemoryReserver_html_ac87a697034b92fb1ee9d45816cb0195c"><div class="ttname"><a href="classMemoryReserver.html#ac87a697034b92fb1ee9d45816cb0195c">MemoryReserver::check_resources</a></div><div class="ttdeci">bool check_resources(InnerTask *task)</div><div class="ttdef"><b>Definition:</b> <a href="phases_8cpp_source.html#l00202">phases.cpp:202</a></div></div>
<div class="ttc" id="aclassMemoryReserver_html_afe7011e52a6115c22c09aa4ce80b37e4"><div class="ttname"><a href="classMemoryReserver.html#afe7011e52a6115c22c09aa4ce80b37e4">MemoryReserver::get_count</a></div><div class="ttdeci">size_t get_count()</div><div class="ttdoc">Get the number of tasks enqueued (and waiting) in the phase.</div><div class="ttdef"><b>Definition:</b> <a href="phases_8cpp_source.html#l00197">phases.cpp:197</a></div></div>
<div class="ttc" id="aclassMemoryReserver_html_afefeed97cbedbebe983d4c9b770bf50f"><div class="ttname"><a href="classMemoryReserver.html#afefeed97cbedbebe983d4c9b770bf50f">MemoryReserver::create_datamove_tasks</a></div><div class="ttdeci">void create_datamove_tasks(InnerTask *task)</div><div class="ttdef"><b>Definition:</b> <a href="phases_8cpp_source.html#l00229">phases.cpp:229</a></div></div>
<div class="ttc" id="aclassRuntimeReserver_html"><div class="ttname"><a href="classRuntimeReserver.html">RuntimeReserver</a></div><div class="ttdoc">RuntimeReserver phase of the scheduler.</div><div class="ttdef"><b>Definition:</b> <a href="phases_8hpp_source.html#l00259">phases.hpp:259</a></div></div>
<div class="ttc" id="aclassRuntimeReserver_html_aeab29f38dfdcc8f13fd839bf2629d1f5"><div class="ttname"><a href="classRuntimeReserver.html#aeab29f38dfdcc8f13fd839bf2629d1f5">RuntimeReserver::enqueue</a></div><div class="ttdeci">void enqueue(InnerTask *task)</div><div class="ttdoc">Enqueue a task to the phase.</div><div class="ttdef"><b>Definition:</b> <a href="phases_8cpp_source.html#l00353">phases.cpp:353</a></div></div>
<div class="ttc" id="aclassSchedulerPhase_html_ab309120518ecaa5abdaba9c4ece2bf5a"><div class="ttname"><a href="classSchedulerPhase.html#ab309120518ecaa5abdaba9c4ece2bf5a">SchedulerPhase::enqueue_buffer</a></div><div class="ttdeci">TaskStateList enqueue_buffer</div><div class="ttdoc">The number of tasks enqueued (and waiting) in the phase.</div><div class="ttdef"><b>Definition:</b> <a href="phases_8hpp_source.html#l00134">phases.hpp:134</a></div></div>
<div class="ttc" id="anamespaceTask_html_a4397689d62196d2cfecf970fcbed6cb5a04bbf98db0e5595240e01fa33ead9ffc"><div class="ttname"><a href="namespaceTask.html#a4397689d62196d2cfecf970fcbed6cb5a04bbf98db0e5595240e01fa33ead9ffc">Task::RUNNABLE</a></div><div class="ttdeci">@ RUNNABLE</div><div class="ttdef"><b>Definition:</b> <a href="runtime_8hpp_source.html#l00170">runtime.hpp:169</a></div></div>
<div class="ttc" id="anamespaceTask_html_afa88d99eb2a58c8f078a53f1195c53a8ac0474346713027b27d364defd7bba79b"><div class="ttname"><a href="namespaceTask.html#afa88d99eb2a58c8f078a53f1195c53a8ac0474346713027b27d364defd7bba79b">Task::RESERVED</a></div><div class="ttdeci">@ RESERVED</div><div class="ttdef"><b>Definition:</b> <a href="runtime_8hpp_source.html#l00113">runtime.hpp:113</a></div></div>
<div class="ttc" id="aprofiling_8hpp_html_a166725049865b4af08e946c886ebe327"><div class="ttname"><a href="profiling_8hpp.html#a166725049865b4af08e946c886ebe327">NVTX_COLOR_LIGHT_GREEN</a></div><div class="ttdeci">#define NVTX_COLOR_LIGHT_GREEN</div><div class="ttdef"><b>Definition:</b> <a href="profiling_8hpp_source.html#l00055">profiling.hpp:55</a></div></div>
<div class="ttc" id="aprofiling_8hpp_html_a4ed1a04fa9103ac0c29157e53ed53e66"><div class="ttname"><a href="profiling_8hpp.html#a4ed1a04fa9103ac0c29157e53ed53e66">NVTX_RANGE</a></div><div class="ttdeci">#define NVTX_RANGE(name, color)</div><div class="ttdef"><b>Definition:</b> <a href="profiling_8hpp_source.html#l00044">profiling.hpp:44</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="classInnerScheduler.html#a17f38e7632a5733f36da2834ef20c99e">InnerScheduler::activate()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMemoryReserver_a03b6be802b5d6d19761773fa7a1df866_icgraph.png" border="0" usemap="#aclassMemoryReserver_a03b6be802b5d6d19761773fa7a1df866_icgraph" alt=""/></div>
<map name="aclassMemoryReserver_a03b6be802b5d6d19761773fa7a1df866_icgraph" id="aclassMemoryReserver_a03b6be802b5d6d19761773fa7a1df866_icgraph">
<area shape="rect" title="Run the phase. Check tasks in the enqueued buffer, check phase condition, and move tasks to the next ..." alt="" coords="461,42,624,69"/>
<area shape="rect" href="classInnerScheduler.html#a17f38e7632a5733f36da2834ef20c99e" title=" " alt="" coords="233,42,413,69"/>
<area shape="rect" href="classInnerScheduler.html#ae07fab8fc43aebfc5bbf73b7474d3e0b" title=" " alt="" coords="5,5,185,47"/>
<area shape="rect" href="classInnerScheduler.html#a19f4d7b87785bdfcd5158e1ffd7c2e0a" title=" " alt="" coords="21,71,169,98"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a966fdf0157ff4674c887804c3938dc39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a966fdf0157ff4674c887804c3938dc39">&#9670;&nbsp;</a></span>name</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::string MemoryReserver::name {&quot;Memory Reserver&quot;}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="phases_8hpp_source.html#l00242">242</a> of file <a class="el" href="phases_8hpp_source.html">phases.hpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="classparla_1_1cython_1_1tasks_1_1Task.html#ababc617b13ac85360836b5d93b8b3a56">parla.cython.tasks.Task::__hash__()</a>, <a class="el" href="classparla_1_1cython_1_1tasks_1_1Task.html#ae9431157ba928a769cc5be59d69b1086">parla.cython.tasks.Task::get_name()</a>, <a class="el" href="classparla_1_1cython_1_1tasks_1_1Task.html#a25aa67289e404c89b26861c5a9df04cf">parla.cython.tasks.Task::unpack_name()</a>, and <a class="el" href="classparla_1_1cython_1_1tasks_1_1Task.html#ac887287421e5c0551d570894bb7e62a7">parla.cython.tasks.Task::update_name()</a>.</p>

</div>
</div>
<a id="a50abec0ef02597ad2b1d74d18c5ec954"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50abec0ef02597ad2b1d74d18c5ec954">&#9670;&nbsp;</a></span>reservable_tasks</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="classPhaseManager.html">PhaseManager</a>&lt;<a class="el" href="resources_8hpp.html#aaf78cb490f07150f95154e6a8c907436a5fe7b9358c9cb1b9eaa8d5aec000def4">ResourceCategory::Persistent</a>&gt; &gt; MemoryReserver::reservable_tasks</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="phases_8hpp_source.html#l00241">241</a> of file <a class="el" href="phases_8hpp_source.html">phases.hpp</a>.</p>

</div>
</div>
<a id="ac879854e744f973327d1c4c76bc2a0ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac879854e744f973327d1c4c76bc2a0ef">&#9670;&nbsp;</a></span>reserved_tasks_buffer</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="classInnerTask.html">InnerTask</a> *&gt; MemoryReserver::reserved_tasks_buffer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="phases_8hpp_source.html#l00244">244</a> of file <a class="el" href="phases_8hpp_source.html">phases.hpp</a>.</p>

</div>
</div>
<a id="a664c53b781e239f130c5a6426052ae38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a664c53b781e239f130c5a6426052ae38">&#9670;&nbsp;</a></span>status</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMemoryReserverStatus.html">MemoryReserverStatus</a> MemoryReserver::status {<a class="el" href="classMemoryReserver.html#a966fdf0157ff4674c887804c3938dc39">name</a>}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="phases_8hpp_source.html#l00243">243</a> of file <a class="el" href="phases_8hpp_source.html">phases.hpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="classparla_1_1cython_1_1scheduler_1_1WorkerThread.html#a17878a66843ff4463f81f1e0606b2adf">parla.cython.scheduler.WorkerThread::run()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/c/backend/include/<a class="el" href="phases_8hpp_source.html">phases.hpp</a></li>
<li>src/c/backend/<a class="el" href="phases_8cpp_source.html">phases.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
